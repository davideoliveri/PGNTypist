<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="logo.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#1a1a1a" />
  <meta name="description"
    content="Quickly transcribe chess games into PGN format using keyboard. Autocompletion and suggestions are available." />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://davideoliveri.github.io/PGNTypist/" />
  <meta property="og:title" content="PGN Typist | Quickly transcribe chess games into PGN format" />
  <meta property="og:description"
    content="Quickly transcribe chess games into PGN format using keyboard. Autocompletion and suggestions are available." />
  <meta property="og:image" content="https://davideoliveri.github.io/PGNTypist/og-image.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://davideoliveri.github.io/PGNTypist/" />
  <meta property="twitter:title" content="PGN Typist | Quickly transcribe chess games into PGN format" />
  <meta property="twitter:description"
    content="Quickly transcribe chess games into PGN format using keyboard. Autocompletion and suggestions are available." />
  <meta property="twitter:image" content="https://davideoliveri.github.io/PGNTypist/og-image.png" />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="PGN Typist | Quickly transcribe chess games into PGN format" />
  <link rel="manifest" href="./manifest.json" />
  <title>PGN Typist | Quickly transcribe chess games into PGN format</title>
</head>

<body>
  <div id="root"></div>
  <script type="module" src="/src/main.tsx"></script>
  <script>
    // Register service worker with update detection
    if ('serviceWorker' in navigator) {
      // Store reference to waiting service worker
      window.__waitingSW = null;

      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => {
            console.log('SW registered:', reg.scope);

            // Check for updates periodically (every 5 minutes)
            setInterval(() => {
              reg.update().catch(() => { });
            }, 5 * 60 * 1000);

            // Check if there's already a waiting worker
            if (reg.waiting) {
              window.__waitingSW = reg.waiting;
              window.dispatchEvent(new CustomEvent('sw-update-available'));
            }

            // Listen for new service worker installing
            reg.addEventListener('updatefound', () => {
              const newWorker = reg.installing;
              if (newWorker) {
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    // New version installed but waiting - store reference
                    window.__waitingSW = newWorker;
                    window.dispatchEvent(new CustomEvent('sw-update-available'));
                  }
                });
              }
            });
          })
          .catch(err => console.log('SW registration failed:', err));

        // Handle controller change (new SW took over) - reload to get new content
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!window.__swReloading) {
            window.__swReloading = true;
            window.location.reload();
          }
        });
      });

      // Function to activate the waiting service worker
      window.activateNewSW = function () {
        if (window.__waitingSW) {
          window.__waitingSW.postMessage({ type: 'SKIP_WAITING' });
        } else {
          // Fallback: just reload
          window.location.reload();
        }
      };
    }
  </script>
</body>

</html>